#!/bin/sh

# This script notify if an appointment is in 30 minutes if 0 is passed in argument the script will notify all daily appointments if 1 is passed in argument the script will notify all appointments of tomorrow

today_appointments() {
    notify-send "ðŸ“… Today appointments" "$(calcurse -D $CALCURSE_DIR -a)"
    exit
}

tomorrow_appointements() {
    month="$(date '+%m')"
    day="$(($(date '+%d') + 1))"
    year="20$(date '+%y')"
    data="$month/$day/$year"
    cmd=$(calcurse -D $CALCURSE_DIR -d "$data")
    notify-send "ðŸ“† Tomorrow appointments" "$cmd"
    exit
}


check_for_appointements() {
    data=$(calcurse -D $CALCURSE_DIR -a | grep "^ - [0-9][0-9]:[0-9][0-9]" | sed "s/ - //g;s/ -> [0-9][0-9]:[0-9][0-9]//g")
    hour=$(date '+%H')
    min=$(date '+%M')
    if [[ $min -lt 30 ]]; then
        to_remove=$((30-$min))
        hour=$(($hour-1))
        min=$((60-$to_remove))
    else
        min=$(($min-30))
    fi
    [[ $min -lt 10 ]] && min=0$min
    now="$hour:$min"
    echo "$now"
    res=$(echo $data | sed "s/ /\n/" | grep "$now")
    [ -z "$res" ] && exit
    notify-send "ðŸ“† Upcoming appointment" "You have an upcoming appointment"
    exit
}

[ -z "$1" ] && check_for_appointements
[ "$1" == "0" ] && today_appointments
[ "$1" == "1" ] && tomorrow_appointements
exit
